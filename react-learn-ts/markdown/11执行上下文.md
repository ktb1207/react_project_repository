### js执行上下文

> 1. 什么是执行上下文？

执行上下文是评估和执行javascript代码的环境抽象概念，每当javascript代码在运行时候，它都是在执行上下文中运行

> 2. 执行上下文分类

- 全局执行上下文：当 JavaScript 执行全局代码的时候，会编译全局代码并创建全局执行上下文，而且在整个页面的生存周期内，全局执行上下文只有一份。
- 函数执行上下文：当调用一个函数的时候，函数体内的代码会被编译，并创建函数执行上下文
- 当使用 eval 函数的时候，eval 的代码也会被编译，并创建执行上下文

> 3. 执行栈

执行栈，也被称为调用栈，是一种拥有`LIFO`(后进先出)数据结构的栈，被用来存储代码运行时创建的所有执行上下文。

当javascript引擎首次开始执行js脚本，它会创建一个全局的执行上下文，并压入执行栈；

每当引擎遇到一个函数调用，它会为该函数创建一个新的函数执行上下文，并压入栈；

javascript引擎会执行位于调用栈栈顶的函数，当函数执行结束，对应的函数执行上下文从栈中弹出，控制流程到达当前栈中的下一个上下文；

> 4. 案例分析

```js
var a = 2 
function add(b,c){ 
    return b+c 
} 
function addAll(b,c){ 
    var d = 10 
    result = add(b,c) 
    return a+result+d
} 
addAll(3,6)
```

- 第一步，创建全局上下文，并将其压入栈底，变量 a、函数 add 和 addAll 都保存到了全局上下文的变量环境对象
- 全局执行上下文压入到调用栈后，JavaScript 引擎开始执行全局代码。首先会执行 a=2 的赋值操作，执行该语句会将全局上下文变量环境中 a 的值设置为 2。
- 第二步是调用 addAll 函数。当调用该函数时，JavaScript 引擎会编译该函数，并为其创建一个执行上下文，最后还将该函数的执行上下文压入栈中；
- addAll 函数的执行上下文创建好之后，便进入了函数代码的执行阶段了，这里先执行的是 d=10 的赋值操作，执行语句会将 addAll 函数执行上下文中的 d 由 undefined 变成了 10。
- 第三步，当执行到 add 函数调用语句时，同样会为其创建执行上下文，并将其压入调用栈
- 当 add 函数返回时，该函数的执行上下文就会从栈顶弹出，并将 result 的值设置为 add 函数的返回值，也就是 9
- 紧接着 addAll 执行最后一个相加操作后并返回，addAll 的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了